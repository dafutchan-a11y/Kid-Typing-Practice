<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lily's Typing Adventure üåü</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Baloo+2:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --pink: #FF6B9D;
            --purple: #C084FC;
            --blue: #60A5FA;
            --green: #4ADE80;
            --yellow: #FBBF24;
            --orange: #FB923C;
            --red: #F87171;
            --text: #334155;
            --gentle-shadow: 0 4px 20px rgba(0,0,0,0.08);
            --pop-shadow: 0 6px 30px rgba(0,0,0,0.12);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Fredoka', sans-serif;
            background: linear-gradient(180deg, #DBEAFE 0%, #FDF2F8 40%, #ECFDF5 70%, #FEF9C3 100%);
            min-height: 100vh;
            overflow-x: hidden;
            color: var(--text);
        }

        /* ===== CLOUDS ===== */
        .bg-decor {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none; z-index: 0; overflow: hidden;
        }
        .cloud { position: absolute; font-size: 3rem; opacity: 0.3; animation: floatCloud linear infinite; }
        .cloud:nth-child(1) { top: 5%; left: -10%; animation-duration: 45s; font-size: 4rem; }
        .cloud:nth-child(2) { top: 15%; left: -10%; animation-duration: 60s; animation-delay: -20s; }
        .cloud:nth-child(3) { top: 35%; left: -10%; animation-duration: 50s; animation-delay: -10s; font-size: 3.5rem; }
        .cloud:nth-child(4) { top: 55%; left: -10%; animation-duration: 70s; animation-delay: -35s; }
        .cloud:nth-child(5) { top: 75%; left: -10%; animation-duration: 55s; animation-delay: -5s; font-size: 2.5rem; }
        @keyframes floatCloud { from { transform: translateX(-100px); } to { transform: translateX(calc(100vw + 100px)); } }

        /* ===== APP ===== */
        .app {
            position: relative; z-index: 1;
            max-width: 780px; margin: 0 auto; padding: 24px 20px 40px;
        }

        /* ===== HEADER ===== */
        .header { text-align: center; margin-bottom: 20px; cursor: default; }
        .header h1 {
            font-family: 'Baloo 2', cursive; font-size: 2.4rem; font-weight: 800;
            background: linear-gradient(135deg, var(--pink), var(--purple), var(--blue));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
            line-height: 1.2; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
        .header .mascot {
            font-size: 2.8rem; display: block; margin-bottom: 4px;
            animation: bounce 2s ease-in-out infinite;
        }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

        /* ===== STATS ROW ===== */
        .stats-row {
            display: flex; justify-content: center; gap: 10px;
            margin-bottom: 20px; flex-wrap: wrap;
        }
        .stat-pill {
            background: white; border-radius: 50px; padding: 8px 16px;
            display: flex; align-items: center; gap: 7px;
            box-shadow: var(--gentle-shadow); font-weight: 600; font-size: 0.95rem;
        }
        .stat-pill .icon { font-size: 1.2rem; }
        .stat-pill .val {
            font-family: 'Baloo 2', cursive; font-weight: 700; font-size: 1.15rem;
        }
        .stat-pill.stars .val { color: var(--yellow); }
        .stat-pill.level .val { color: var(--purple); }
        .stat-pill.streak .val { color: var(--orange); }
        .stat-pill.best .val { color: var(--blue); }

        /* ===== ADVENTURE MAP ===== */
        .adventure-map {
            background: white; border-radius: 20px; padding: 16px 20px;
            margin-bottom: 20px; box-shadow: var(--gentle-shadow); overflow: hidden;
        }
        .map-title {
            font-family: 'Baloo 2', cursive; font-weight: 700;
            font-size: 1.05rem; color: var(--purple); margin-bottom: 10px;
        }
        .map-trail {
            display: flex; align-items: center; gap: 0;
            overflow-x: auto; padding: 8px 4px; scrollbar-width: none;
        }
        .map-trail::-webkit-scrollbar { display: none; }
        .map-stop {
            flex-shrink: 0; width: 48px; height: 48px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.4rem; border: 3px solid #E2E8F0; background: #F8FAFC;
            transition: all 0.3s;
        }
        .map-stop.completed { border-color: var(--green); background: #DCFCE7; transform: scale(1.05); }
        .map-stop.current {
            border-color: var(--yellow); background: #FEF9C3; transform: scale(1.15);
            box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.25);
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.25); }
            50% { box-shadow: 0 0 0 8px rgba(251, 191, 36, 0.15); }
        }
        .map-stop.locked { opacity: 0.5; filter: grayscale(0.5); }
        .map-connector { flex-shrink: 0; width: 24px; height: 4px; background: #E2E8F0; border-radius: 2px; }
        .map-connector.done { background: var(--green); }

        /* ===== TYPING CARD ===== */
        .typing-card {
            background: white; border-radius: 24px; padding: 28px 24px 24px;
            box-shadow: var(--pop-shadow); margin-bottom: 20px;
            position: relative; overflow: hidden;
        }
        .typing-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 5px;
            background: linear-gradient(90deg, var(--pink), var(--purple), var(--blue), var(--green), var(--yellow));
        }
        .level-badge {
            display: inline-flex; align-items: center; gap: 6px;
            background: linear-gradient(135deg, #F3E8FF, #EDE9FE);
            border: 2px solid var(--purple); border-radius: 50px;
            padding: 5px 14px; font-weight: 600; font-size: 0.85rem; color: #7C3AED;
            margin-bottom: 16px;
        }
        .prompt-label {
            font-weight: 600; color: #94A3B8; font-size: 0.8rem;
            text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;
        }
        .text-display {
            background: linear-gradient(135deg, #FEFCE8, #FFF7ED);
            border: 3px solid #FDE68A; border-radius: 16px; padding: 20px;
            font-family: 'Fredoka', sans-serif; font-size: 1.65rem; line-height: 2;
            margin-bottom: 16px; min-height: 70px;
            word-wrap: break-word; overflow-wrap: break-word; letter-spacing: 0.5px;
        }
        .text-display .char { display: inline; transition: all 0.15s; border-radius: 3px; padding: 0 1px; }
        .text-display .char.correct { color: #16A34A; background: rgba(74, 222, 128, 0.2); }
        .text-display .char.incorrect {
            color: #DC2626; background: rgba(248, 113, 113, 0.25);
            text-decoration: wavy underline; text-decoration-color: #F87171;
        }
        .text-display .char.current {
            background: rgba(96, 165, 250, 0.35); border-radius: 4px;
            animation: blink 1s ease-in-out infinite;
        }
        @keyframes blink {
            0%, 100% { background: rgba(96, 165, 250, 0.35); }
            50% { background: rgba(96, 165, 250, 0.15); }
        }
        .text-display .char.pending { color: #94A3B8; }

        .progress-wrap {
            background: #F1F5F9; border-radius: 20px; height: 12px;
            margin-bottom: 16px; overflow: hidden;
        }
        .progress-fill {
            height: 100%; border-radius: 20px;
            background: linear-gradient(90deg, var(--green), #34D399);
            transition: width 0.3s; position: relative;
        }
        .progress-fill::after {
            content: '‚≠ê'; position: absolute; right: -6px; top: -8px;
            font-size: 1.2rem; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.2));
        }

        .typing-input {
            width: 100%; padding: 14px 18px; font-family: 'Fredoka', sans-serif;
            font-size: 1.35rem; border: 3px solid #CBD5E1; border-radius: 14px;
            transition: all 0.2s; background: #FAFAFA; color: var(--text);
        }
        .typing-input:focus {
            outline: none; border-color: var(--blue);
            box-shadow: 0 0 0 4px rgba(96, 165, 250, 0.2); background: white;
        }
        .typing-input.has-error {
            border-color: var(--red);
            box-shadow: 0 0 0 4px rgba(248, 113, 113, 0.15);
        }
        .typing-input::placeholder { color: #CBD5E1; font-weight: 400; }

        .hint-row {
            display: flex; justify-content: space-between; align-items: center;
            margin-top: 12px; flex-wrap: wrap; gap: 8px;
        }
        .mini-stats {
            display: flex; gap: 16px; font-size: 0.85rem;
            color: #64748B; font-weight: 500;
        }
        .mini-stats span { display: flex; align-items: center; gap: 4px; }
        .session-info {
            font-size: 0.8rem; color: #94A3B8; font-weight: 500;
            text-align: center; margin-top: 8px;
        }

        /* ===== BUTTONS ===== */
        .btn-row { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        .btn {
            font-family: 'Fredoka', sans-serif; font-size: 1rem; font-weight: 600;
            border: none; border-radius: 14px; padding: 12px 24px;
            cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 8px;
        }
        .btn:active { transform: scale(0.96); }
        .btn-primary {
            background: linear-gradient(135deg, var(--blue), var(--purple));
            color: white; box-shadow: 0 4px 15px rgba(96, 165, 250, 0.35);
        }
        .btn-primary:hover { box-shadow: 0 6px 20px rgba(96, 165, 250, 0.5); transform: translateY(-1px); }
        .btn-secondary { background: #F1F5F9; color: var(--text); }
        .btn-secondary:hover { background: #E2E8F0; }
        .btn-fun {
            background: linear-gradient(135deg, var(--yellow), var(--orange));
            color: white; box-shadow: 0 4px 15px rgba(251, 191, 36, 0.35);
        }
        .btn-fun:hover { box-shadow: 0 6px 20px rgba(251, 191, 36, 0.5); transform: translateY(-1px); }
        .btn-sticker {
            background: linear-gradient(135deg, var(--pink), #F472B6);
            color: white; box-shadow: 0 4px 15px rgba(255, 107, 157, 0.35);
        }
        .btn-sticker:hover { box-shadow: 0 6px 20px rgba(255, 107, 157, 0.5); transform: translateY(-1px); }

        /* ===== STICKER BOOK BUTTON (below typing card) ===== */
        .sticker-btn-row {
            display: flex; justify-content: center; margin-bottom: 20px;
        }

        /* ===== CELEBRATION OVERLAY ===== */
        .overlay {
            display: none; position: fixed; inset: 0; z-index: 100;
            justify-content: center; align-items: center;
            background: rgba(0,0,0,0.3); backdrop-filter: blur(4px);
        }
        .overlay.show { display: flex; }
        .overlay-card {
            background: white; border-radius: 28px; padding: 36px 40px;
            text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            max-width: 440px; width: 90%;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 90vh; overflow-y: auto;
        }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .overlay-card .big-emoji { font-size: 4rem; display: block; margin-bottom: 8px; }
        .overlay-card h2 {
            font-family: 'Baloo 2', cursive; font-size: 1.8rem; font-weight: 800;
            color: var(--purple); margin-bottom: 4px;
        }
        .overlay-card .sub { color: #64748B; font-size: 0.95rem; margin-bottom: 16px; }
        .reward-line { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
        .reward-item { text-align: center; }
        .reward-item .r-val { font-family: 'Baloo 2', cursive; font-size: 1.6rem; font-weight: 700; }
        .reward-item .r-label { font-size: 0.75rem; color: #94A3B8; font-weight: 600; text-transform: uppercase; }
        .new-animal, .level-up-msg {
            display: none; border-radius: 14px; padding: 12px;
            margin-bottom: 16px; font-weight: 600;
        }
        .new-animal { background: linear-gradient(135deg, #FEF9C3, #FDE68A); color: #92400E; }
        .level-up-msg { background: linear-gradient(135deg, #EDE9FE, #F3E8FF); color: #6D28D9; }
        .new-animal.show, .level-up-msg.show { display: block; }

        /* ===== STICKER BOOK OVERLAY ===== */
        .sticker-book h2 {
            font-family: 'Baloo 2', cursive; font-size: 1.8rem; font-weight: 800;
            color: var(--pink); margin-bottom: 4px;
        }
        .sticker-book .sticker-count {
            color: #64748B; font-size: 0.95rem; margin-bottom: 20px;
        }
        .sticker-grid {
            display: grid; grid-template-columns: repeat(6, 1fr);
            gap: 10px; margin-bottom: 20px;
        }
        .sticker-cell {
            aspect-ratio: 1; border-radius: 14px; display: flex;
            align-items: center; justify-content: center; font-size: 2rem;
            transition: all 0.3s; position: relative;
        }
        .sticker-cell.unlocked {
            background: linear-gradient(135deg, #F0FDF4, #DCFCE7);
            border: 2px solid var(--green);
            animation: stickerIdle 3s ease-in-out infinite;
        }
        .sticker-cell.unlocked:hover { transform: scale(1.15); }
        @keyframes stickerIdle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .sticker-cell.locked {
            background: #F1F5F9; border: 2px dashed #D1D5DB;
            font-size: 1.3rem; color: #CBD5E1;
        }
        .sticker-cell .sticker-num {
            position: absolute; bottom: 2px; right: 6px;
            font-size: 0.55rem; color: #94A3B8; font-weight: 600;
        }

        /* ===== CONFETTI ===== */
        #confetti-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 200;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 600px) {
            .header h1 { font-size: 1.8rem; }
            .text-display { font-size: 1.3rem; padding: 16px; }
            .typing-input { font-size: 1.15rem; }
            .stat-pill { padding: 6px 10px; font-size: 0.8rem; }
            .overlay-card { padding: 24px 20px; }
            .sticker-grid { grid-template-columns: repeat(4, 1fr); }
        }
    </style>
</head>
<body>
    <div class="bg-decor">
        <div class="cloud">‚òÅÔ∏è</div><div class="cloud">‚òÅÔ∏è</div><div class="cloud">‚òÅÔ∏è</div>
        <div class="cloud">‚òÅÔ∏è</div><div class="cloud">‚òÅÔ∏è</div>
    </div>
    <canvas id="confetti-canvas"></canvas>

    <div class="app">
        <!-- HEADER (click title 5x for parent reset) -->
        <div class="header">
            <span class="mascot" id="mascot">ü¶ä</span>
            <h1 id="titleClick">Lily's Typing Adventure</h1>
        </div>

        <!-- STATS -->
        <div class="stats-row">
            <div class="stat-pill stars"><span class="icon">‚≠ê</span><span class="val" id="totalStars">0</span></div>
            <div class="stat-pill level"><span class="icon">üèîÔ∏è</span><span class="val" id="levelName">Level 1</span></div>
            <div class="stat-pill streak"><span class="icon">üî•</span><span class="val" id="streakCount">0</span></div>
            <div class="stat-pill best"><span class="icon">‚ö°</span><span class="val" id="bestWpm">0 WPM</span></div>
        </div>

        <!-- ADVENTURE MAP -->
        <div class="adventure-map">
            <div class="map-title">üó∫Ô∏è Adventure Trail</div>
            <div class="map-trail" id="mapTrail"></div>
        </div>

        <!-- TYPING CARD -->
        <div class="typing-card">
            <div class="level-badge" id="levelBadge">üå∏ Sunny Sentences</div>
            <div class="prompt-label">Type this:</div>
            <div class="text-display" id="textDisplay"></div>
            <div class="progress-wrap">
                <div class="progress-fill" id="progress" style="width: 0%"></div>
            </div>
            <input type="text" class="typing-input" id="typingInput" placeholder="Start typing here..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
            <div class="hint-row">
                <div class="mini-stats">
                    <span>‚ö° <span id="wpm">0</span> WPM</span>
                    <span>üéØ <span id="accuracy">100</span>%</span>
                </div>
                <div class="btn-row">
                    <button class="btn btn-secondary" id="skipBtn">Skip ‚è≠Ô∏è</button>
                    <button class="btn btn-primary" id="nextBtn">Next ‚ú®</button>
                </div>
            </div>
            <div class="session-info" id="sessionInfo"></div>
        </div>

        <!-- STICKER BOOK BUTTON -->
        <div class="sticker-btn-row">
            <button class="btn btn-sticker" id="openStickers">üéÄ My Sticker Book</button>
        </div>
    </div>

    <!-- CELEBRATION OVERLAY -->
    <div class="overlay" id="celebration">
        <div class="overlay-card">
            <span class="big-emoji" id="celebEmoji">üéâ</span>
            <h2 id="celebTitle">Amazing!</h2>
            <p class="sub" id="celebSub">You typed it perfectly!</p>
            <div class="reward-line">
                <div class="reward-item"><div class="r-val" id="celebStars" style="color:var(--yellow);">+3</div><div class="r-label">Stars</div></div>
                <div class="reward-item"><div class="r-val" id="celebWpm" style="color:var(--blue);">8</div><div class="r-label">WPM</div></div>
                <div class="reward-item"><div class="r-val" id="celebAcc" style="color:var(--green);">100%</div><div class="r-label">Accuracy</div></div>
            </div>
            <div class="level-up-msg" id="levelUpMsg">üéâ Level Up! <span id="levelUpName"></span></div>
            <div class="new-animal" id="newAnimal">üéÅ New friend unlocked: <span id="newAnimalName"></span></div>
            <button class="btn btn-fun" id="celebNext">Keep Going! üöÄ</button>
        </div>
    </div>

    <!-- STICKER BOOK OVERLAY -->
    <div class="overlay" id="stickerOverlay">
        <div class="overlay-card sticker-book">
            <span class="big-emoji">üéÄ</span>
            <h2>My Sticker Book</h2>
            <p class="sticker-count" id="stickerCount">0 of 24 friends found!</p>
            <div class="sticker-grid" id="stickerGrid"></div>
            <button class="btn btn-primary" id="closeStickers">Back to Typing ‚ú®</button>
        </div>
    </div>

    <script>
    // ============================================
    // LEVELS
    // ============================================
    const LEVELS = [
        { name: "Sunny Sentences", icon: "üå∏", emoji: "üåª", mascot: "ü¶ä" },
        { name: "Silly Stories", icon: "ü§™", emoji: "ü¶Ñ", mascot: "üê±" },
        { name: "Animal Kingdom", icon: "ü¶Å", emoji: "üêò", mascot: "üê∂" },
        { name: "Magical Forest", icon: "üå≤", emoji: "üßö", mascot: "ü¶â" },
        { name: "Explorer's Path", icon: "üß≠", emoji: "üèîÔ∏è", mascot: "üêª" },
        { name: "Storybook Land", icon: "üìñ", emoji: "üè∞", mascot: "ü¶ã" },
        { name: "Typing Champion", icon: "üëë", emoji: "üèÜ", mascot: "üê≤" }
    ];

    // ============================================
    // SENTENCE BANKS
    // Punctuation progression:
    //   L1-2: lowercase, no punctuation
    //   L3-4: Capital start + period
    //   L5-6: Capitals + periods + commas
    //   L7:   Full punctuation (! ? , .)
    // ============================================

    // LEVEL 1 ‚Äî Sunny Sentences (5-7 words, all lowercase, no punctuation)
    const level1 = [
        "the cat sat on the mat",
        "i like to read my books",
        "she ran fast to the park",
        "my dog loves to play fetch",
        "the sun is warm and bright",
        "we had fun at the beach",
        "i can see a pretty bird",
        "the ball went over the wall",
        "he gave her a big hug",
        "my mom made a yummy cake",
        "the fish swam in the pond",
        "i drew a picture for you",
        "we sang a song together",
        "the baby smiled at the puppy",
        "it is time to go home",
        "dad helped me ride my bike",
        "she found a shell by the sea",
        "the moon came out at night",
        "i put my shoes on fast",
        "we played a game after lunch",
        "the frog jumped into the water",
        "i love my family so much",
        "he gave the horse an apple",
        "the stars are very far away",
        "she drank a glass of milk",
        "i found a penny on the ground",
        "the tree has lots of leaves",
        "my brother is funny and kind",
        "the rain made all the puddles",
        "we built a tower with blocks"
    ];

    // LEVEL 2 ‚Äî Silly Stories (6-9 words, all lowercase, no punctuation)
    const level2 = [
        "a penguin wore pajamas to the party",
        "the silly frog ate a sandwich for lunch",
        "my hamster tried to drive the toy car",
        "a raccoon juggled three shiny red apples",
        "the bear forgot to brush his teeth again",
        "a parrot sang a song about pancakes",
        "the rabbit wore a crown made of flowers",
        "a duck brought an umbrella to the bathtub",
        "the monkey hid cookies under his pillow",
        "a squirrel packed a suitcase full of acorns",
        "the turtle won the race and did a dance",
        "a kitten pretended to be a brave lion",
        "the cow jumped over a giant cupcake",
        "a fox painted a rainbow on the fence",
        "the pig learned to play the piano today",
        "a giraffe tried to hide behind a tiny bush",
        "the owl asked everyone a tricky question",
        "a mouse made a machine that creates cheese",
        "the sheep knitted a sweater out of clouds",
        "a crab did a cartwheel across the beach",
        "the elephant squeezed into a tiny sleeping bag",
        "a snail delivered letters to all the neighbors",
        "the chicken told the funniest joke ever",
        "a hedgehog opened a bakery in the garden",
        "the horse wore sunglasses and a big straw hat",
        "a bunny tried to teach a fish to dance",
        "the goat ate the homework right off the table",
        "a flamingo wore rain boots to the pond",
        "the otter floated on a giant leaf for fun",
        "a panda made a fort out of bamboo sticks"
    ];

    // LEVEL 3 ‚Äî Animal Kingdom (8-11 words, capital + period only)
    const level3 = [
        "The clever dolphin splashed through the bright blue ocean waves.",
        "A family of ducks waddled across the road in a line.",
        "The baby elephant sprayed water with its trunk to cool down.",
        "A curious owl watched the forest from a tall oak tree.",
        "The little penguin slid down the icy hill on its belly.",
        "A friendly sea turtle swam through the warm ocean water.",
        "The mother bird taught her babies how to spread their wings.",
        "A playful otter floated on its back and ate a clam.",
        "The spotted ladybug landed gently on a bright yellow daisy.",
        "A hungry caterpillar munched its way through a crispy green leaf.",
        "The fireflies glowed like tiny lanterns in the summer evening.",
        "A proud rooster crowed loudly as the morning sun came up.",
        "The gray whale traveled a very long way to find warm water.",
        "A group of meerkats stood together watching the golden sunset.",
        "The hermit crab moved into a beautiful new shell it found.",
        "A gentle deer and her fawn drank from the quiet stream.",
        "The busy bees worked together to make sweet golden honey.",
        "A colorful butterfly rested its wings on a purple flower.",
        "The cheetah is the fastest animal running on the land.",
        "A wise old tortoise told stories to the younger animals.",
        "The arctic fox turned white to match the deep winter snow.",
        "A tiny hummingbird flapped its wings faster than you could see.",
        "The octopus changed its color to match the sandy ocean floor.",
        "A mother kangaroo carried her baby safe inside her warm pouch.",
        "The woodpecker tapped on the tree trunk looking for its dinner.",
        "A sleepy koala held onto its favorite branch all day long.",
        "The beaver built a cozy dam from sticks and smooth mud.",
        "A little chipmunk stored seeds inside its round puffy cheeks.",
        "The blue jay sang a cheerful song from the garden fence.",
        "A fluffy baby chick followed its mother around the sunny farm."
    ];

    // LEVEL 4 ‚Äî Magical Forest (10-13 words, capital + period only)
    const level4 = [
        "The friendly dragon brought warm blankets to everyone in the tiny village.",
        "A magical garden grew flowers that sparkled like jewels under the moonlight.",
        "The brave princess discovered a secret tunnel behind the castle waterfall.",
        "A kind wizard used a special spell to help the lost animals.",
        "The enchanted forest had trees that whispered stories to anyone who listened.",
        "A fairy built a cozy little house inside a hollow mushroom cap.",
        "The unicorn galloped across a rainbow bridge that stretched over the valley.",
        "A tiny elf used a thimble as a bucket to water the flowers.",
        "The magical library had books that could read themselves out loud to you.",
        "A clever gnome invented a lantern that was powered by starlight and wishes.",
        "The mermaid found a treasure chest full of pretty seashells and pearls.",
        "A phoenix spread its glowing wings and lit up the entire dark forest.",
        "The talking squirrel gave directions to the travelers who had lost their way.",
        "A special mirror showed you the happiest memory you had ever forgotten.",
        "The castle in the clouds had rooms made of soft cotton candy walls.",
        "A silver fox led the children safely through the deep snowy woods.",
        "The enchanted music box played a song that made every flower bloom.",
        "A guardian owl watched over the sleeping forest creatures each and every night.",
        "The crystal cave sparkled with lights that danced like a thousand fireflies.",
        "A friendly giant carefully tiptoed through the village so nobody was frightened.",
        "The wishing well granted one kind wish to every person who visited.",
        "A rainbow colored bird delivered happy messages between all the forest animals.",
        "The magical paintbrush brought every picture to life as soon as it was drawn.",
        "A group of fairies worked together to mend the broken butterfly wings.",
        "The golden key hidden under the stone unlocked a door to a new world.",
        "A baby dragon sneezed and accidentally covered the garden in tiny sparkles.",
        "The enchanted river flowed uphill and carried little paper boats to the mountain.",
        "A kind troll shared his lunch with the birds who visited the old bridge.",
        "The talking flowers sang together in a chorus when the morning sun appeared.",
        "A brave little mouse set out on a journey to find the lost star."
    ];

    // LEVEL 5 ‚Äî Explorer's Path (12-15 words, capitals + periods + commas)
    const level5 = [
        "The children followed a winding trail through the forest, and discovered a hidden waterfall.",
        "A bright rainbow appeared across the sky, right after the afternoon storm had ended.",
        "We built a cozy blanket fort in the living room, and read stories all evening.",
        "The explorer wrote about every amazing animal and plant she found, filling her whole journal.",
        "A family of foxes made their warm little home under the roots of an old tree.",
        "The lighthouse keeper turned on the beacon each night, helping the ships find their way.",
        "We planted sunflower seeds in the spring, and watched them grow taller than the garden fence.",
        "A shooting star flew across the dark sky, just before we climbed into our sleeping bags.",
        "The mountain trail was steep and rocky, but the view from the top was beautiful.",
        "A gentle breeze carried the smell of fresh baked cookies, all through the neighborhood streets.",
        "The old treasure map led us to a wooden box, buried under the biggest oak tree.",
        "We collected smooth colored stones from the riverbed, and used them to decorate the garden path.",
        "A family of swans glided gracefully across the still lake, as the sun began to set.",
        "The children drew a giant chalk mural on the sidewalk, with every color they could find.",
        "We watched the tadpoles in the pond slowly change, and grow tiny legs over the next few weeks.",
        "A hot air balloon floated quietly over the rolling green hills, and the patchwork farm fields.",
        "The tidepool was full of tiny crabs and colorful starfish, hiding under the wet rocks.",
        "We made a bird feeder out of a pinecone, and hung it from the maple tree branch.",
        "The autumn leaves turned orange and red and gold, before they floated gently to the ground.",
        "A friendly park ranger showed us how to identify the different animal tracks, in the soft mud.",
        "After a long hike through the meadow, we sat down by the stream and had a picnic.",
        "The old wooden bridge creaked a little, but it held strong as we crossed over the creek.",
        "We found a nest with three tiny blue eggs, tucked safely in the branches of the birch tree.",
        "The campfire crackled and popped, while we roasted marshmallows and told stories under the stars.",
        "A curious rabbit hopped right up to our tent, sniffed around for a moment, and then left.",
        "The morning fog slowly lifted from the lake, showing the mountains reflected perfectly in the still water.",
        "We followed the sound of rushing water, until we found a creek bubbling over smooth round stones.",
        "The garden was buzzing with butterflies and bees, all visiting the rows of bright summer flowers.",
        "A family of deer stepped quietly through the meadow, stopping to nibble the fresh green grass.",
        "We packed our backpacks with snacks and water bottles, then set off down the trail together."
    ];

    // LEVEL 6 ‚Äî Storybook Land (14-18 words, capitals + periods + commas)
    const level6 = [
        "Once upon a time, a curious kitten wandered into the garden and found a tiny door hidden behind the roses.",
        "The young inventor spent the whole afternoon building a machine, that could turn falling rain into a beautiful rainbow.",
        "Every night before bed, the grandmother told a story about the magical creatures that lived under the old stone bridge.",
        "The brave little mouse set out on a long journey, to bring back the special flower for her sick friend.",
        "A clever bird figured out how to open the garden gate, by pulling the string attached to the heavy latch.",
        "The children worked together to build a tree house, with a rope ladder and a special lookout window on top.",
        "When the snow finally melted in the spring, the first tiny purple flowers poked their heads out of the cold ground.",
        "The old clockmaker carefully fixed every gear and spring, until the grandfather clock began to tick and chime once more.",
        "A pack of friendly wolves sang a song together under the full moon, while the forest animals listened from their burrows.",
        "The baker woke up before sunrise every single morning, to make sure the fresh bread was ready when the village woke up.",
        "The librarian always knew exactly which book to suggest, because she had read every single one on the tall wooden shelves.",
        "A small seed that fell between the sidewalk cracks, grew into a strong flower that everyone in the town stopped to admire.",
        "The little boat sailed across the calm lake, while the children took turns steering and watching for fish below the clear water.",
        "After the rainstorm passed, the children ran outside barefoot and splashed in every single puddle they could find on the driveway.",
        "The traveling musician played her violin in the town square, and soon a crowd of people gathered around to listen and dance.",
        "A tiny ant carried a crumb of bread all the way across the picnic blanket, while the family watched in amazement.",
        "The old lighthouse stood tall on the rocky cliff, keeping its warm light shining through every storm that rolled in from the sea.",
        "A mother hen carefully tucked each of her baby chicks under her soft warm wings, as the cold evening wind began to blow.",
        "The friendly postman knew everyone in the village by name, and always stopped to chat and share a kind word with each person.",
        "A group of children planted a small garden behind the school, and by summer it was full of tomatoes and sunflowers and beans.",
        "The wise old owl perched on the highest branch of the tallest tree, and watched over the forest as the last light faded away.",
        "A little girl discovered that her drawings came to life at night, and every morning she found tiny footprints all over her desk.",
        "The train conductor blew the whistle twice, and the bright red engine slowly pulled out of the station on its journey through the mountains.",
        "Every autumn, the squirrels in the park rushed around gathering acorns, stuffing their cheeks full and hiding treasures under every bush and rock.",
        "A gentle snow began to fall on the quiet village, covering the rooftops and the trees in a soft blanket of sparkling white."
    ];

    // LEVEL 7 ‚Äî Typing Champion (12-20 words, full punctuation: . , ! ?)
    const level7 = [
        "The astronaut looked out the window and could see the whole Earth glowing blue and green below. What an amazing sight!",
        "We packed sandwiches and lemonade in a basket, and walked to the park for a picnic. It was a perfect day!",
        "The curious scientist peered through her microscope, and discovered a tiny world that no one had ever seen before.",
        "Every Saturday morning, the whole family worked together in the garden. Can you guess what they planted? Tomatoes and sunflowers!",
        "A mother duck waited patiently by the pond, until every single one of her ducklings had safely crossed the busy road.",
        "The artist mixed blue and yellow paint together on her palette. She created the most beautiful shade of green!",
        "During the winter, the squirrels ate the acorns they had carefully hidden all through the autumn. What a clever plan!",
        "The kind neighbor brought over a pot of warm soup. Wasn't that a thoughtful thing to do?",
        "We stayed up late enough to see the meteor shower! We counted more than twenty shooting stars across the night sky.",
        "The rescue dog found the lost hiker on the mountain trail, and led the search team right to where she was waiting.",
        "A caterpillar spun itself into a chrysalis, and after two weeks emerged as a gorgeous monarch butterfly. How amazing is that?",
        "The children put on their rain boots and went stomping through the muddy trails. What a fun adventure after the big storm!",
        "My grandmother taught me how to bake her famous cookies, and now I make them every Sunday afternoon. They taste wonderful!",
        "The deep blue ocean is home to millions of different creatures, from the tiniest plankton to the enormous blue whale.",
        "We discovered that the old attic was full of interesting treasures! There was a music box, and a stack of hand drawn maps.",
        "The community came together to plant hundreds of trees along the riverbank. Can you imagine how beautiful it will look in a few years?",
        "A baby sea turtle hatched from its egg on the sandy beach, and scrambled toward the sparkling moonlit ocean. Go little turtle!",
        "The science fair project about growing plants with different music won first place! The results were so surprising.",
        "Every evening, the old golden retriever waited by the front door. He wagged his tail until his favorite person came home from school.",
        "The farmer carefully checked on each animal in the barn every morning. Did they all have enough food and fresh clean water?",
        "Have you ever watched a spider build its web? It is one of the most incredible things in nature!",
        "The little girl ran up to her dad and asked, can we go to the park today? He smiled and said yes!",
        "What a wonderful morning it was! The birds were singing, the flowers were blooming, and the sky was perfectly blue.",
        "After months of practice, the young gymnast finally did a perfect cartwheel. She was so proud of herself!",
        "Is there anything better than a warm cup of hot chocolate on a cold winter day? I really do not think so!",
        "The puppy chased its own tail in circles, then flopped over and fell asleep. How funny was that?",
        "We learned so many interesting facts at the museum today! Did you know that some dinosaurs were as small as chickens?",
        "The whole class worked together to put on a play for their families. Everyone clapped and cheered at the end!",
        "Would you rather fly like a bird or swim like a fish? That is a really hard question to answer!",
        "The kite soared high above the trees, dancing in the wind. What a perfect way to spend a breezy afternoon!"
    ];

    const ALL_BANKS = [level1, level2, level3, level4, level5, level6, level7];

    // ============================================
    // GAME DATA
    // ============================================
    const ADVENTURE_ANIMALS = [
        "üê±", "üê∂", "üê∞", "ü¶ä", "üêª", "üêº", "üê®", "ü¶Å",
        "üêØ", "üê∏", "üêß", "ü¶â", "ü¶ã", "üê¢", "üê¨", "ü¶Ñ",
        "üêò", "ü¶í", "üêô", "üêù", "ü¶©", "üê≥", "ü¶ú", "üê≤"
    ];
    const ANIMAL_NAMES = [
        "Whiskers", "Biscuit", "Clover", "Maple", "Honey", "Bamboo", "Pebble", "Sunny",
        "Stripe", "Bubbles", "Waddle", "Hootie", "Flutter", "Sheldon", "Splash", "Sparkle",
        "Jumbo", "Stretch", "Inky", "Buzz", "Coral", "Misty", "Kiwi", "Ember"
    ];
    const CELEBRATIONS = ["Amazing!", "Wonderful!", "Fantastic!", "Super!", "Brilliant!", "You rock!", "Woo hoo!", "Great job!", "Way to go!", "Incredible!", "Awesome!", "Perfect!"];
    const CELEB_EMOJIS = ["üéâ", "üåü", "ü•≥", "‚ú®", "üí´", "üéä", "‚≠ê", "üèÜ", "üíñ", "üåà"];
    const EXERCISES_TO_LEVEL_UP = 3;

    function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

    // ============================================
    // STATE
    // ============================================
    const SAVE_KEY = "lilys-typing-adventure-v3";
    let state = {
        totalStars: 0,
        level: 0,
        streak: 0,
        bestStreak: 0,
        bestWpm: 0,
        exercisesCompleted: 0,
        unlockedAnimals: [0],
        starsToNextAnimal: 8,
        starsSinceLastAnimal: 0,
        levelProgress: 0,
        recentSentences: [],
        sessionCount: 0,
        sessionDate: null
    };

    function saveState() { try { localStorage.setItem(SAVE_KEY, JSON.stringify(state)); } catch(e) {} }
    function loadState() {
        try {
            const s = localStorage.getItem(SAVE_KEY);
            if (s) Object.assign(state, JSON.parse(s));
        } catch(e) {}
    }

    function todayStr() { return new Date().toDateString(); }

    function getSentence() {
        const bank = ALL_BANKS[Math.min(state.level, ALL_BANKS.length - 1)];
        const available = bank.filter(s => !state.recentSentences.includes(s));
        const pool = available.length > 0 ? available : bank;
        const sentence = pick(pool);
        state.recentSentences.push(sentence);
        if (state.recentSentences.length > 10) state.recentSentences.shift();
        return sentence;
    }

    // ============================================
    // TYPING ENGINE
    // ============================================
    let currentText = "";
    let currentIndex = 0;
    let errors = 0;
    let totalKeystrokes = 0;
    let startTime = null;
    let timerInterval = null;
    let isComplete = false;

    const textDisplay = document.getElementById('textDisplay');
    const typingInput = document.getElementById('typingInput');
    const progressBar = document.getElementById('progress');
    const wpmEl = document.getElementById('wpm');
    const accuracyEl = document.getElementById('accuracy');

    function renderText() {
        textDisplay.innerHTML = currentText.split('').map((char, i) => {
            let cls = 'char';
            if (i < currentIndex) {
                cls += typingInput.value[i] === char ? ' correct' : ' incorrect';
            } else if (i === currentIndex) {
                cls += ' current pending';
            } else {
                cls += ' pending';
            }
            return `<span class="${cls}">${char}</span>`;
        }).join('');
    }

    function getWPM() {
        if (!startTime) return 0;
        const mins = (Date.now() - startTime) / 60000;
        return mins > 0 ? Math.round((currentIndex / 5) / mins) : 0;
    }

    function getAccuracy() {
        return totalKeystrokes > 0 ? Math.round(((totalKeystrokes - errors) / totalKeystrokes) * 100) : 100;
    }

    function updateDisplay() {
        wpmEl.textContent = getWPM();
        accuracyEl.textContent = getAccuracy();
        const pct = currentText.length > 0 ? (currentIndex / currentText.length) * 100 : 0;
        progressBar.style.width = pct + '%';
    }

    function loadExercise() {
        currentText = getSentence();
        currentIndex = 0;
        errors = 0;
        totalKeystrokes = 0;
        startTime = null;
        isComplete = false;
        clearInterval(timerInterval);

        typingInput.value = '';
        typingInput.disabled = false;
        typingInput.classList.remove('has-error');
        progressBar.style.width = '0%';
        wpmEl.textContent = '0';
        accuracyEl.textContent = '100';

        renderText();
        typingInput.focus();

        const lvl = LEVELS[state.level];
        document.getElementById('levelBadge').textContent = `${lvl.icon} ${lvl.name}`;
        document.getElementById('mascot').textContent = lvl.mascot;
    }

    function handleInput() {
        if (isComplete) return;
        const typed = typingInput.value;

        if (!startTime && typed.length > 0) {
            startTime = Date.now();
            timerInterval = setInterval(updateDisplay, 500);
        }

        const newIndex = typed.length;
        if (newIndex > currentIndex) {
            totalKeystrokes++;
            if (typed[newIndex - 1] !== currentText[newIndex - 1]) {
                errors++;
                typingInput.classList.add('has-error');
                setTimeout(() => typingInput.classList.remove('has-error'), 200);
            }
        }
        currentIndex = newIndex;
        renderText();
        updateDisplay();

        if (currentIndex >= currentText.length) completeExercise();
    }

    function completeExercise() {
        isComplete = true;
        clearInterval(timerInterval);
        typingInput.disabled = true;

        const wpm = getWPM();
        const acc = getAccuracy();

        let starsEarned = 1;
        if (acc >= 90) starsEarned++;
        if (acc === 100) starsEarned++;
        if (wpm >= 8) starsEarned++;
        if (wpm >= 15) starsEarned++;

        state.totalStars += starsEarned;
        state.streak++;
        if (state.streak > state.bestStreak) state.bestStreak = state.streak;
        if (wpm > state.bestWpm) state.bestWpm = wpm;
        state.exercisesCompleted++;
        state.levelProgress++;
        state.starsSinceLastAnimal += starsEarned;

        // Session counting (resets daily)
        if (state.sessionDate !== todayStr()) {
            state.sessionDate = todayStr();
            state.sessionCount = 0;
        }
        state.sessionCount++;

        // Animal unlock
        let newAnimal = null;
        if (state.starsSinceLastAnimal >= state.starsToNextAnimal && state.unlockedAnimals.length < ADVENTURE_ANIMALS.length) {
            const idx = state.unlockedAnimals.length;
            state.unlockedAnimals.push(idx);
            state.starsSinceLastAnimal = 0;
            state.starsToNextAnimal = Math.min(state.starsToNextAnimal + 2, 20);
            newAnimal = { emoji: ADVENTURE_ANIMALS[idx], name: ANIMAL_NAMES[idx] };
        }

        // Level up
        let didLevelUp = false;
        if (state.levelProgress >= EXERCISES_TO_LEVEL_UP && acc >= 70 && state.level < LEVELS.length - 1) {
            state.level++;
            state.levelProgress = 0;
            didLevelUp = true;
        }

        saveState();
        showCelebration(starsEarned, wpm, acc, newAnimal, didLevelUp);
        updateAllUI();
    }

    // ============================================
    // CELEBRATION & CONFETTI
    // ============================================
    function showCelebration(stars, wpm, acc, newAnimal, didLevelUp) {
        document.getElementById('celebEmoji').textContent = pick(CELEB_EMOJIS);
        document.getElementById('celebTitle').textContent = pick(CELEBRATIONS);

        let sub;
        if (acc === 100) sub = "Perfect! Not a single mistake!";
        else if (acc >= 95) sub = "So close to perfect!";
        else if (acc >= 80) sub = "Really nice typing!";
        else sub = "Keep going, you are getting better!";
        document.getElementById('celebSub').textContent = sub;

        document.getElementById('celebStars').textContent = `+${stars}`;
        document.getElementById('celebWpm').textContent = wpm;
        document.getElementById('celebAcc').textContent = acc + '%';

        const animalEl = document.getElementById('newAnimal');
        if (newAnimal) {
            document.getElementById('newAnimalName').textContent = `${newAnimal.emoji} ${newAnimal.name}`;
            animalEl.classList.add('show');
        } else {
            animalEl.classList.remove('show');
        }

        const lvlEl = document.getElementById('levelUpMsg');
        if (didLevelUp) {
            document.getElementById('levelUpName').textContent = LEVELS[state.level].icon + " " + LEVELS[state.level].name;
            lvlEl.classList.add('show');
        } else {
            lvlEl.classList.remove('show');
        }

        document.getElementById('celebration').classList.add('show');
        fireConfetti();
    }

    function hideCelebration() {
        document.getElementById('celebration').classList.remove('show');
        loadExercise();
    }

    // Confetti
    const confettiCanvas = document.getElementById('confetti-canvas');
    const ctx = confettiCanvas.getContext('2d');
    let confettiPieces = [];
    let confettiAnimId = null;

    function resizeConfetti() {
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeConfetti);
    resizeConfetti();

    function fireConfetti() {
        confettiPieces = [];
        const colors = ['#FF6B9D','#C084FC','#60A5FA','#4ADE80','#FBBF24','#FB923C','#F87171'];
        for (let i = 0; i < 80; i++) {
            confettiPieces.push({
                x: Math.random() * confettiCanvas.width,
                y: -20 - Math.random() * 200,
                w: 6 + Math.random() * 6,
                h: 10 + Math.random() * 10,
                color: pick(colors),
                vx: (Math.random() - 0.5) * 4,
                vy: 2 + Math.random() * 3,
                rot: Math.random() * 360,
                rotV: (Math.random() - 0.5) * 10,
                life: 1
            });
        }
        if (!confettiAnimId) animateConfetti();
    }

    function animateConfetti() {
        ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        confettiPieces.forEach(p => {
            p.x += p.vx; p.y += p.vy; p.vy += 0.05; p.rot += p.rotV; p.life -= 0.005;
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.rot * Math.PI / 180);
            ctx.globalAlpha = Math.max(0, p.life);
            ctx.fillStyle = p.color;
            ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
            ctx.restore();
        });
        confettiPieces = confettiPieces.filter(p => p.life > 0 && p.y < confettiCanvas.height + 50);
        if (confettiPieces.length > 0) {
            confettiAnimId = requestAnimationFrame(animateConfetti);
        } else {
            ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
            confettiAnimId = null;
        }
    }

    // ============================================
    // STICKER BOOK
    // ============================================
    function openStickerBook() {
        const grid = document.getElementById('stickerGrid');
        grid.innerHTML = '';
        ADVENTURE_ANIMALS.forEach((animal, i) => {
            const cell = document.createElement('div');
            cell.className = 'sticker-cell';
            if (state.unlockedAnimals.includes(i)) {
                cell.classList.add('unlocked');
                cell.innerHTML = `${animal}<span class="sticker-num">${ANIMAL_NAMES[i]}</span>`;
            } else {
                cell.classList.add('locked');
                cell.textContent = '‚ùì';
            }
            grid.appendChild(cell);
        });
        const count = state.unlockedAnimals.length;
        document.getElementById('stickerCount').textContent = `${count} of ${ADVENTURE_ANIMALS.length} friends found!`;
        document.getElementById('stickerOverlay').classList.add('show');
    }

    function closeStickerBook() {
        document.getElementById('stickerOverlay').classList.remove('show');
        typingInput.focus();
    }

    // ============================================
    // PARENT RESET (click title 5 times quickly)
    // ============================================
    let resetClicks = 0;
    let resetTimer = null;
    document.getElementById('titleClick').addEventListener('click', () => {
        resetClicks++;
        clearTimeout(resetTimer);
        resetTimer = setTimeout(() => { resetClicks = 0; }, 2000);
        if (resetClicks >= 5) {
            resetClicks = 0;
            if (confirm("Parent reset: This will erase all of Lily's progress (stars, animals, level). Are you sure?")) {
                localStorage.removeItem(SAVE_KEY);
                state = {
                    totalStars: 0, level: 0, streak: 0, bestStreak: 0, bestWpm: 0,
                    exercisesCompleted: 0, unlockedAnimals: [0], starsToNextAnimal: 8,
                    starsSinceLastAnimal: 0, levelProgress: 0, recentSentences: [],
                    sessionCount: 0, sessionDate: null
                };
                saveState();
                updateAllUI();
                loadExercise();
            }
        }
    });

    // ============================================
    // UI UPDATES
    // ============================================
    function updateAllUI() {
        document.getElementById('totalStars').textContent = state.totalStars;
        document.getElementById('levelName').textContent = LEVELS[state.level].name;
        document.getElementById('streakCount').textContent = state.streak;
        document.getElementById('bestWpm').textContent = state.bestWpm + " WPM";
        renderMap();
        updateSessionInfo();
    }

    function renderMap() {
        const trail = document.getElementById('mapTrail');
        trail.innerHTML = '';
        LEVELS.forEach((lvl, i) => {
            if (i > 0) {
                const conn = document.createElement('div');
                conn.className = 'map-connector' + (i <= state.level ? ' done' : '');
                trail.appendChild(conn);
            }
            const stop = document.createElement('div');
            stop.className = 'map-stop';
            if (i < state.level) stop.classList.add('completed');
            else if (i === state.level) stop.classList.add('current');
            else stop.classList.add('locked');
            stop.textContent = i <= state.level ? lvl.emoji : 'üîí';
            stop.title = lvl.name;
            trail.appendChild(stop);
        });
        setTimeout(() => {
            const cur = trail.querySelector('.current');
            if (cur) cur.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
        }, 100);
    }

    function updateSessionInfo() {
        const el = document.getElementById('sessionInfo');
        if (state.sessionDate === todayStr() && state.sessionCount > 0) {
            el.textContent = `You typed ${state.sessionCount} sentence${state.sessionCount !== 1 ? 's' : ''} today! üåü`;
        } else {
            el.textContent = '';
        }
    }

    // ============================================
    // EVENTS
    // ============================================
    typingInput.addEventListener('input', handleInput);
    typingInput.addEventListener('paste', e => e.preventDefault());
    document.getElementById('nextBtn').addEventListener('click', () => loadExercise());
    document.getElementById('skipBtn').addEventListener('click', () => {
        state.streak = 0;
        saveState();
        updateAllUI();
        loadExercise();
    });
    document.getElementById('celebNext').addEventListener('click', hideCelebration);
    document.getElementById('openStickers').addEventListener('click', openStickerBook);
    document.getElementById('closeStickers').addEventListener('click', closeStickerBook);
    document.addEventListener('keydown', e => {
        if (e.key === 'Enter' && document.getElementById('celebration').classList.contains('show')) hideCelebration();
        if (e.key === 'Escape' && document.getElementById('stickerOverlay').classList.contains('show')) closeStickerBook();
    });

    // ============================================
    // INIT
    // ============================================
    loadState();
    updateAllUI();
    loadExercise();

    </script>
</body>
</html>
